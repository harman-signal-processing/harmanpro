<%= content_for :title do %>
  <%= @vertical_market.name %>
<% end %>

<% if @vertical_market.children.length > 0 %>
  <div class="bumped-up space-after">
    <div class="banner-container vertical-market">
      <%= image_tag @vertical_market.banner.url(:large) %>
    </div>
    <div class="row">
      <div class="large-5 large-offset-2 small-8 columns">
        <div class="panel slider-container">
          <h1><%= @vertical_market.name %></h1>
        </div>
      </div>
    </div>
  </div>

  <div class="container main-container">
    <div class="row">
      <div class="large-8 large-offset-2 columns">
        <h1 class="text-center space-after"><%= @vertical_market.headline %></h1>
        <%= raw @vertical_market.description %>
        <ul class="small-block-grid-2 medium-block-grid-3 large-block-grid-3">
          <% @vertical_market.children.each do |vm| %>
            <li>
              <div class="panel">
                <div class="text-center">
                  <%= link_to vm.name, vm %>
                </div>
              </div>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  </div>

<% else %>

  <div ng-controller="VerticalMarketCtrl as vm" vmurl="<%= vertical_market_path(@vertical_market, format: :json) %>">
    <div class="bumped-up">

      <div class="banner-container vertical-market">
        <% if @vertical_market.reference_systems.count > 0 %>
          <img ng-src="{{ vm.currentSystem()['banner_url'] }}" ng-show="vm.systems.length > 0" img-preload />
        <% else %>
          <img src="<%= asset_path(@vertical_market.banner.url(:large)) %>"/>
        <% end %>
      </div>

      <div class="row">
        <div class="large-5 large-offset-2 small-8 columns">
          <div class="slider-container panel">
            <a name="learn"></a>
            <h1 data-magellan-destination="learn"><%= @vertical_market.name %></h1>

            <div ng-show="vm.systems.length > 1">
              <slider
                floor="1"
                ceiling="{{ vm.systems.length }}"
                step="1"
                precision="0"
                ng-model="vm.slider_pos">
              </slider>

              <ul class="small-block-grid-{{ vm.systems.length }} medium-block-grid-{{ vm.systems.length }} large-block-grid-{{ vm.systems.length }}">
                <li ng-repeat="system in vm.systems">{{ system.slider_name }}</li>
              </ul>
            </div>

          </div>
        </div>
      </div>

    </div>

    <%= render "shared/learn_plan_buy_nav.html.erb" %>

    <div class="container main-container">
      <div class="row">
        <div class="large-8 large-offset-2 columns">

          <div class="reference_system_container" ng-show="vm.systems.length > 0">
            <h2>{{ vm.currentSystem()['headline'] }}</h2>
            {{ vm.currentSystem()['description'] }}

            <div class="system-diagram-container">
              <script type="text/ng-template" id="popover-template">
                <div class="triangle"></div>
                <div class="ns-popover-tooltip">
                  <h5 class="subheader">{{ vm.selectedProductType["name"] }}</h5>
                  <p>{{ vm.selectedProductType["description"] }}</p>
                  <i>Product Suggestions:</i>
                  <ul>
                    <li ng-repeat="product in vm.selectedProductType['products']">
                      <a href="{{ product.url }}" target="_blank">{{ product.name }}</a>
                    </li>
                  </ul>
                  <button ng-click="hidePopover()" class="tiny button">Close</button>
                </div>
              </script>

              <img src="<%= asset_path "q.png" %>" alt="[?]" class="help-icon" ns-popover
                ng-repeat="product_type in vm.currentSystem()['reference_system_product_types']"
                ptid="{{ product_type.id }}"
                ng-style="{'left': product_type.left, 'top': product_type.top}"
                ng-click="vm.setProductType(product_type)"
                ns-popover-modal="product-type-popups"
                ns-popover-theme="ns-popover-tooltip-theme"
                ns-popover-timeout="7"
                ns-popover-template="popover-template"/>
              <img ng-src="{{ vm.currentSystem()['system_diagram_url'] }}" img-preload/>
            </div>
          </div>

          <noscript>
            <h5 class="subheader">Explore these examples:</h5>
            <ul>
              <%= @vertical_market.featured_reference_systems.each do |reference_system| %>
                <li><%= link_to reference_system.name, [@vertical_market, reference_system] %></li>
              <% end %>
            </ul>
          </noscript>

          <%= render "learn", vertical_market: @vertical_market %>

        </div>
      </div>
    </div>

  </div>

  <%= render "plan", vertical_market: @vertical_market %>
  <%= render "buy", vertical_market: @vertical_market %>

<% end %>
