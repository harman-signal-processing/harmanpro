<%= content_for :title do %>Locate a Harman Pro Service Center<% end %>
<%= content_for :description do %>Find a local service center to repair your HARMAN Professional products.<% end %>

<%= render 'shared/service_subnav' %>

<div class="container main-container">
  <div class="row">
    <div class="large-12 medium-12 columns">
      <div class="callout panel">
        <%= search_form_for @search, class: "custom" do |f| %>
          <div class="row">
            <div class="large-3 medium-3 small-12 columns">
              <%= f.label :state_eq, "Select your state:" %>
              <%= f.select :state_eq, options_for_select([["(any)", nil]] + ServiceCenter.states, @selected) %>
            </div>
            <div class="large-7 medium-7 small-12 columns">
              <%= f.label :service_groups_name_eq, "Service type needed:" %>
              <%= f.select :service_groups_name_eq, options_for_select([["(any)", nil]] + ServiceGroup.names, @selected_group) %>
            </div>
            <div class="large-2 medium-2 small-12 columns">
              <br/>
              <%= f.submit "Search", class: "small button" %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="large-12 columns">
      <% if @service_centers  %>
        <% if @service_centers.length > 0 %>
          <table width="100%">
            <thead>
              <tr>
                <th>Name</th>
                <th>Address/Phone</th>
                <th>Services</th>
              </tr>
            </thead>

            <tbody>
              <% @service_centers.sort{|a,b| b.service_center_service_groups.count <=> a.service_center_service_groups.count}.each do |service_center| %>
                <tr>
                  <td>
                    <%= service_center.name %>
                    <% if service_center.email.present? %>
                      <br/><%= raw auto_link service_center.email %>
                    <% end %>
                    <% if service_center.website.present? %>
                      <br/><%= raw auto_link service_center.website %>
                    <% end %>
                  </td>
                  <td>
                    <%= service_center.address %><br/>
                    <%= service_center.city %>,
                    <%= service_center.state %>
                    <%= service_center.zip %>
                    <% if service_center.phone.present? %>
                      <br/><strong><%= raw service_center.phone.to_s.gsub(/\s/, "&nbsp;") %></strong>
                    <% end %>
                  </td>
                  <td>
                    <ul>
                      <% service_center.service_groups.each do |sg| %>
                        <li><%= sg.name %></li>
                      <% end %>
                    </ul>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        <% else %>
          <p><i>No search results found. Please try again. Try entering just the state abbreviation.</i></p>
        <% end %>
      <% end %>
    </div>
  </div>

</div>
