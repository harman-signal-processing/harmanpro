<%= content_for :title do %>
  <%= @reference_system.name %>
<% end %>

<div class="bumped-up">
  <div class="banner-container reference-system">
    <%= image_tag(@reference_system.banner.url(:large)) %>
  </div>
  <div class="row">
    <div class="large-5 large-offset-2 small-8 columns">
      <div class="panel slider-container">
        <a name="learn"></a>
        <h1 data-magellan-destination="learn"><%= @reference_system.slider_name %></h1>
        <p>
          <% if @reference_system.previous %>
            <%= link_to "previous", [@vertical_market, @reference_system.previous] %>
          <% end %>
          <% if @reference_system.next %>
            <%= link_to "next", [@vertical_market, @reference_system.next] %>
          <% end %>
        </p>
        <p>More <%= link_to "#{@vertical_market.name.downcase} examples", @vertical_market %>...</p>
      </div>
    </div>
  </div>
</div>

<%= render "shared/learn_plan_buy_nav.html.erb" %>

<div class="container main-container">
  <div class="row">
    <div class="large-8 large-offset-2 columns">

      <div class="reference_system_container"
        ng-controller="ReferenceSystemCtrl as rs"
        rsurl="<%= vertical_market_reference_system_path(@vertical_market, @reference_system, format: :json) %>">
        <h2><%= @reference_system.headline %></h2>
        <%=raw @reference_system.description %>

        <div class="system-diagram-container">
          <script type="text/ng-template" id="popover-template">
            <div class="triangle"></div>
            <div class="ns-popover-tooltip">
              <h5 class="subheader">{{ rs.selectedProductType["name"] }}</h5>
              <p>{{ rs.selectedProductType["description"] }}</p>
              <i>Product Suggestions:</i>
              <ul>
                <li ng-repeat="product in rs.selectedProductType['products']">
                  <a href="{{ product.url }}" target="_blank">{{ product.name }}</a>
                </li>
              </ul>
              <button ng-click="hidePopover()" class="tiny button">Close</button>
            </div>
          </script>

          <img src="<%= asset_path "q.png" %>" alt="[?]" class="help-icon" ns-popover
            ng-repeat="product_type in rs.system['reference_system_product_types']"
            ptid="{{ product_type.id }}"
            ng-style="{'left': product_type.left, 'top': product_type.top}"
            ng-click="rs.setProductType(product_type)"
            ns-popover-modal="product-type-popups"
            ns-popover-theme="ns-popover-tooltip-theme"
            ns-popover-timeout="7"
            ns-popover-template="popover-template"/>
          <%= image_tag(@reference_system.system_diagram.url(:large)) %>

          <noscript>
            <h5 class="subheader">Explore these product suggestions:</h5>
            <ul class="small-block-grid-1 large-block-grid-4 medium-block-grid-2">
              <% @reference_system.reference_system_product_types.each do |rspt| %>
                <li><div class="panel">
                  <h5 class="subheader"><%= link_to rspt.product_type.name, '#' %></h5>
                  <ul>
                    <% rspt.products.each do |product| %>
                      <li>
                        <h6><%= link_to product.name, product.url, target: "_blank" %></h6>
                        <div><%= product.description %></div>
                        <%= link_to "more info", product.url, target: "_blank" %>
                      </li>
                    <% end %>
                  </ul>
                </div>
                </li>
              <% end %>
            </ul>
          </noscript>
        </div>
      </div>

      <%= render "vertical_markets/learn", vertical_market: @vertical_market %>
    </div>
  </div>
</div>

<%= render "vertical_markets/plan", vertical_market: @vertical_market %>
<%= render "vertical_markets/buy", vertical_market: @vertical_market %>

